{"version":3,"sources":["../src/coefficientchange.js"],"names":["define","coefs","process","data","document","getElementById","i","length","coef","element","addEventListener","onInput","placeholder","value","dispatchEvent","CustomEvent","Item","id","placeHolder","parseInt","prototype","toString","load","str","replace","sum","newCoefs","coefId","coefIterator","hidden","push","updatePlaceholders","updateValues","updateErrors","values","item","part","Math","floor","index","sort","a","b","temp","shift","splice"],"mappings":"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","sourcesContent":["\ndefine(function() {\n    var coefs = [];\n\n    function process(data) {\n        // quit if the form wasn't created (an exception was thrown)\n        if (!document.getElementById('id_responseformat')) {\n            return;\n        }\n\n        coefs = data;\n        for (var i = 0; i < coefs.length; i++) {\n            // eslint-disable-next-line no-loop-func\n            (function() {\n                var coef = coefs[i];\n                var element = document.getElementById(coef);\n                element.addEventListener('input', function() {\n                    onInput(element, coef, false);\n                });\n                onInput(element, coef, true);\n\n                element.addEventListener('dblclick', function() {\n                    if (element.placeholder.length !== 0) {\n                        element.value = element.placeholder;\n                    }\n                    element.dispatchEvent(new CustomEvent('update'));\n                });\n            }());\n        }\n    }\n\n    function Item(id, value) {\n        this.id = id;\n        this.placeHolder = value.length === 0;\n        this.value = this.placeHolder ? 0 : parseInt(value);\n    }\n\n    Item.prototype.toString = function() {\n        return this.id + \" : \" + this.value;\n    };\n\n    function onInput(element, coef, load) {\n        var str = element.value.toString().replace(/[^0-9]/g, '');\n        if (str.length !== 0) {\n            var value = parseInt(str, 10);\n            if (value > 100) {\n                value = 100;\n            }\n            element.value = value;\n            element.placeholder = '';\n        } else {\n            element.value = '';\n        }\n\n        var sum = 0;\n        var newCoefs = [];\n        for (var i = 0; i < coefs.length; i++) {\n            var coefId = coefs[i];\n            var coefIterator = document.getElementById(coefId);\n            if (!coefIterator.hidden) {\n                newCoefs.push(coefId);\n                sum += coefIterator.value.length === 0 ? 0 : parseInt(coefIterator.value, 10);\n            }\n        }\n\n        if (sum <= 100) {\n            updatePlaceholders(sum, newCoefs);\n        } else {\n            updateValues(sum, coef, newCoefs);\n        }\n        if (!load) {\n            updateErrors();\n        }\n    }\n\n    function updatePlaceholders(sum, newCoefs) {\n        var i,\n            values = [];\n        for (i = 0; i < newCoefs.length; i++) {\n            var coefId = newCoefs[i];\n            var item = new Item(coefId, document.getElementById(coefId).value);\n            if (item.placeHolder) {\n                values.push(item);\n            }\n        }\n\n        if (values.length === 0) {\n            return;\n        }\n\n        sum = 100 - sum;\n        var part = Math.floor(sum / values.length);\n        for (i = 0; i < values.length; i++) {\n            values[i].value = part;\n            sum -= part;\n        }\n        if (values.length > 1 && sum !== 0) {\n            for (var index = 0; sum !== 0; sum--) {\n                values[index].value++;\n                index = index + 1 === values.length ? 0 : index + 1;\n            }\n        }\n        for (i = 0; i < values.length; i++) {\n            var value = values[i];\n            document.getElementById(value.id).placeholder = value.value;\n        }\n    }\n\n    function updateValues(sum, coef, newCoefs) {\n        var value,\n            i,\n            values = [];\n        sum -= 100;\n        for (i = 0; i < newCoefs.length; i++) {\n            var coefId = newCoefs[i];\n            var item = new Item(coefId, document.getElementById(coefId).value);\n            if (item.value !== 0 && coefId !== coef) {\n                values.push(item);\n            }\n        }\n\n        var part = Math.floor(sum / values.length);\n        for (i = 0; i < values.length; i++) { // subtract as much as we can\n            value = values[i];\n            if (value.value - part >= 0) {\n                value.value -= part;\n                sum -= part;\n            } else {\n                sum -= value.value;\n                value.value = 0;\n            }\n        }\n        if (values.length > 1 && sum !== 0) {\n            values.sort(function(a, b) {\n                return b.value - a.value;\n            }); // sort values\n            while (sum-- !== 0) {             // now start subtracting 1\n                var temp = values.shift();    // and keeping the sort order\n                temp.value--;\n                var index = 0;\n                for (i = 0; i < values.length; i++) {\n                    if (values[i] <= temp.value) {\n                        index = i;\n                        break;\n                    }\n                }\n                values.splice(index, 0, temp);\n            }\n        }\n        for (i = 0; i < values.length; i++) { // replacing values\n            value = values[i];\n            document.getElementById(value.id).value = value.value;\n        }\n    }\n\n    function updateErrors() {\n        for (var i = 0; i < coefs.length; i++) {\n            document.getElementById(coefs[i]).dispatchEvent(new CustomEvent('update'));\n        }\n    }\n    return {process: process};\n});"],"file":"coefficientchange.min.js"}