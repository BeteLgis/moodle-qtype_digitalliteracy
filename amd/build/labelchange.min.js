define(function(){var i,d=function(l){var i=0,r=[null],d=function(e,t){throw t=t||i,new Error("Error at "+t+": "+e+"\n"+l+"\n"+" ".repeat(t)+"^")},o=function(e,t){return e===l.slice(i,i+=e.length)?t:d("Expected '"+e+"'",i-e.length)};var a=function(e){return t=/^\d+/,n="an unsigned integer",e=(e=e)||";",o(":"),(t=t.exec(l.slice(i)))||d("Expected "+n+", but got '"+l.slice(i).match(/^[:;{}]|[^:;{}]*/)[0]+"'"),i+=t[0].length,+o(e,t[0]);var t,n},c=function(e){return e=e||"",function(e,t){t=t||"";for(var n=i;0<e;){var r=l.charCodeAt(i++);e-=r<128?1:r<2048||r>>11==27?2:3}return e?d("Invalid string length",n-2):o(t,l.slice(n,i))}(a(':"'),'"'+e)};function s(e){for(var t,n=0,r=a(":{");n<r;n++)e[t=void 0,"s"===(t=l[i++])?c(";"):"i"===t?a(";"):d("Expected 's' or 'i' as type for a key, but got ${str[offset-1]}",i-1)]=u();return o("}",e)}function u(){var e,t=l[i++].toLowerCase(),n=r.push(null)-1,e="s"===t?c(";"):"a"===t?(e=s({}),Object.keys(e).some(function(e,t){return e!==t.toString()})?e:Object.values(e)):d("Unexpected type "+t,i-1);return"r"!==t&&(r[n]=e),e}var e=u();return i!==l.length&&d("Unexpected trailing character"),e},s=[],u=[],c={},f={},p=null,h=null,m={};function o(e,t,n){e.normalize();var r,l="",i=Array.from(e.childNodes).find(function(e){return e.nodeType===Node.TEXT_NODE&&""!==(l="string"==typeof e.textContent?e.textContent:e.innerText).trim()});i?((r=document.createElement("span")).appendChild(document.createTextNode(l)),r[n]=t,e.replaceChild(r,i)):console.log("TextNode not found, label id "+e.id)}function a(e){for(var t,n=p.options[p.selectedIndex].value,r=0;r<s.length;r++){var l,i,d=s[r];y(l=document.getElementById("id_"+d+"_label_span"),i=document.getElementById("id_"+d),i.parentElement,m[d+"_"+n]),i.dispatchEvent(new CustomEvent("change"))}for(r=0;r<u.length;r++){var o=u[r];l=document.getElementById("fgroup_id_"+o+"_label_span"),i=document.getElementById("fgroup_id_"+o);var a,c=m[o+"_"+n];y(l,i,i,c)||((a=document.getElementById("fgroup_id_"+o+"_help_title")).setAttribute("title",m[o+"_help_title_"+n]),a.setAttribute("aria-label",m[o+"_help_title_"+n]),document.getElementById("fgroup_id_"+o+"_help_text").setAttribute("data-content",m[o+"_help_text_"+n]));o=document.getElementById("id_"+o+"coef");y(null,o,o.parentElement.parentElement,c)&&(o.value=0),o.dispatchEvent(new CustomEvent("update"))}t=n,(e=e)||(h.value=f[t].value,(e=document.querySelector('[data-filetypesdescriptions="id_filetypeslist"]')).firstChild.innerHTML=m.filetype_description,(e=e.firstChild.firstChild.firstChild).firstChild.replaceChild(document.createTextNode(f[t].description+" "),e.firstChild.firstChild),e.lastChild.replaceChild(document.createTextNode(h.value),e.lastChild.firstChild))}function y(e,t,n,r){return void 0===r?(t.hidden=!0,n.style.display="none"):(t.hidden=!1,n.style.display="",e&&e.replaceChild(document.createTextNode(r),e.firstChild)),t.hidden}function t(){var d=document.querySelector('[data-filetypesbrowserbody="id_filetypeslist"]');if(null===d||d.hasAttribute("data-used"))setTimeout(t,100);else{d.setAttribute("data-used","true");for(var o=p.options[p.selectedIndex].value,a=0;a<d.children.length;a++)!function(){var e=d.children[a],t="";if(e.getAttribute("data-filetypesbrowserkey")!==c[o])t="none";else{var n=e.querySelectorAll('input[data-filetypesbrowserkey][type="checkbox"]'),r=h.value.toString(),l={count:r=""===r?0:r.replace(","," ").split(" ").length,last:null};_(n,l);for(var i=0;i<n.length;i++)!function(){var e=n[i];e.addEventListener("change",function(){l.count+=e.checked?1:-1,_(n,l)})}()}e.style.display=t}()}}function _(e,t){1===t.count&&(t.last=Array.from(e).find(function(e){return e.checked})),t.last&&(t.last.disabled=1===t.count)}function g(){var e=document.querySelector('[data-filetypesbrowser="id_filetypeslist"]');0<e.childElementCount?e.firstChild.addEventListener("click",function(){t()}):setTimeout(g,100)}return{process:function(e){if(document.getElementById("id_responseformat")){i=e.version,s=e.params,u=e.groups,c=e.types.matches,f=e.types.defaults,p=document.getElementById("id_responseformat"),(h=document.getElementById("id_filetypeslist")).setAttribute("readonly","true");var t,n,r=document.getElementById("id_labels_container"),e=r.getAttribute("data-serialized");for(m=d(e),r.remove(),console.log(Object.keys(m).length+" labels were successfully parsed, container was removed"),t=0;t<s.length;t++)n="id_"+s[t],o(document.getElementById(n).parentElement,n+"_label_span","id");for(t=0;t<u.length;t++){n="fgroup_id_"+u[t],o(202e7<i?document.getElementById(n+"_label"):document.querySelector('[for="'+n+'"]'),n+"_label_span","id");var l=document.getElementById(n).children.item(0).children.item(0).children.item(0);l.id=n+"_help_text",l.children.item(0).id=n+"_help_title"}p.addEventListener("change",function(){a(!1)}),a(!0),g()}}}});