define(function(){function a(a){if(document.getElementById("id_responseformat")){j=a.params,k=a.groups,l=a.types.matches,m=a.types.defaults,n=document.getElementById("id_responseformat"),o=document.getElementById("id_filetypeslist"),o.setAttribute("readonly","true");var d=document.getElementById("id_labels_container"),e=d.getAttribute("data-serialized");p=i.parse(e),d.remove(),console.log(Object.keys(p).length+" labels were successfully parsed, container was removed");for(var f in k)b(document.getElementById("fgroup_id_"+f))!==k[f]+1&&console.log("Group "+f+" was incorrectly labeled");n.addEventListener("change",function(){c(!1)}),c(!0),h()}}function b(a){for(var c=0,d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(e.nodeType===Node.TEXT_NODE){var f=e.textContent.toString().trim();if(0!==f.length){var g=document.createElement("span");g.appendChild(document.createTextNode(f)),g.id=void 0!==k[f]?"fgroup_id_"+f+"_label_span":void 0!==j[f]?"id_"+f+"_label_span":"",0!==g.id.length&&(a.replaceChild(g,e),c++)}}else 0!==e.childNodes.length&&(c+=b(e))}return c}function c(a){var b,c,f,g=n.options[n.selectedIndex].value;for(var h in j){for(b=document.getElementById("id_"+h+"_label_span"),c=document.getElementById("id_"+h),f=c.parentElement;0===f.attributes.length;)f=f.parentElement;d([c,f],p[h+"_"+g],b),c.dispatchEvent(new CustomEvent("change"))}for(var i in k){b=document.getElementById("fgroup_id_"+i+"_label_span"),c=document.getElementById("fgroup_id_"+i);var l=document.getElementById("id_"+i+"coef");d([c,l],p[i+"_"+g],b)&&(l.value=0),l.dispatchEvent(new CustomEvent("update"))}e(g,a)}function d(a,b,c){return void 0===b?a.forEach(function(a){a.hidden=!0,a.style.display="none"}):(a.forEach(function(a){a.hidden=!1,a.style.display=""}),c&&c.replaceChild(document.createTextNode(b),c.firstChild)),void 0===b}function e(a,b){if(!b){o.value=m[a].value;var c=document.querySelector('[data-filetypesdescriptions="id_filetypeslist"]');if(!c)return;c.firstChild.innerHTML=p.filetype_description;var d=c.firstChild.firstChild.firstChild;d.firstChild.replaceChild(document.createTextNode(m[a].description+" "),d.firstChild.firstChild),d.lastChild.replaceChild(document.createTextNode(o.value),d.lastChild.firstChild)}}function f(){var a=document.querySelector('[data-filetypesbrowserbody="id_filetypeslist"]');if(null===a||a.hasAttribute("data-used"))setTimeout(f,100);else{a.setAttribute("data-used","true");for(var b=n.options[n.selectedIndex].value,c=0;c<a.children.length;c++)!function(){var d=a.children[c],e="";if(d.getAttribute("data-filetypesbrowserkey")!==l[b])e="none";else{var f=d.querySelectorAll('input[data-filetypesbrowserkey][type="checkbox"]'),h=o.value.toString();h=""===h?0:h.replace(","," ").split(" ").length;var i={count:h,last:null};g(f,i);for(var j=0;j<f.length;j++)!function(){var a=f[j];a.addEventListener("change",function(){i.count+=a.checked?1:-1,g(f,i)})}()}d.style.display=e}()}}function g(a,b){1===b.count&&(b.last=Array.from(a).find(function(a){return a.checked})),b.last&&(b.last.disabled=1===b.count)}function h(){var a=document.querySelector('[data-filetypesbrowser="id_filetypeslist"]');a&&(a.childElementCount>0?a.firstChild.addEventListener("click",function(){f()}):setTimeout(h,100))}var i={parse:function(a){function b(b,c,d){d=d||";",k(":");var e=b.exec(a.slice(h));return e||j("Expected "+c+", but got '"+a.slice(h).match(/^[:;{}]|[^:;{}]*/)[0]+"'"),h+=e[0].length,k(d,e[0])}function c(b,c){c=c||"";for(var d=h;b>0;){var e=a.charCodeAt(h++);b-=e<128?1:e<2048||e>>11===27?2:3}return b?j("Invalid string length",d-2):k(c,a.slice(d,h))}function d(){var b=a[h++];return"s"===b?m(";"):"i"===b?l(";"):j("Expected 's' or 'i' as type for a key, but got ${str[offset-1]}",h-1)}function e(a){for(var b=0,c=l(":{");b<c;b++)a[d()]=g();return k("}",a)}function f(){var a=e({});return Object.keys(a).some(function(a,b){return a!==b.toString()})?a:Object.values(a)}function g(){var b=a[h++].toLowerCase(),c=i.push(null)-1,d="s"===b?m(";"):"a"===b?f():j("Unexpected type "+b,h-1);return"r"!==b&&(i[c]=d),d}var h=0,i=[null],j=function(b,c){throw c=c||h,new Error("Error at "+c+": "+b+"\n"+a+"\n"+" ".repeat(c)+"^")},k=function(b,c){return b===a.slice(h,h+=b.length)?c:j("Expected '"+b+"'",h-b.length)},l=function(a){return+b(/^\d+/,"an unsigned integer",a)},m=function(a){return a=a||"",c(l(':"'),'"'+a)},n=g();return h!==a.length&&j("Unexpected trailing character"),n}},j={},k={},l={},m={},n=null,o=null,p={};return{process:a}});