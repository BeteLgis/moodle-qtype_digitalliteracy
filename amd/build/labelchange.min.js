define(function(){var l=function(i){var l=0,r=[null],d=function(e,t){throw t=t||l,new Error("Error at "+t+": "+e+"\n"+i+"\n"+" ".repeat(t)+"^")},o=function(e,t){return e===i.slice(l,l+=e.length)?t:d("Expected '"+e+"'",l-e.length)};var a=function(e){return t=/^\d+/,n="an unsigned integer",e=(e=e)||";",o(":"),(t=t.exec(i.slice(l)))||d("Expected "+n+", but got '"+i.slice(l).match(/^[:;{}]|[^:;{}]*/)[0]+"'"),l+=t[0].length,+o(e,t[0]);var t,n},c=function(e){return e=e||"",function(e,t){t=t||"";for(var n=l;0<e;){var r=i.charCodeAt(l++);e-=r<128?1:r<2048||r>>11==27?2:3}return e?d("Invalid string length",n-2):o(t,i.slice(n,l))}(a(':"'),'"'+e)};function s(e){for(var t,n=0,r=a(":{");n<r;n++)e[t=void 0,"s"===(t=i[l++])?c(";"):"i"===t?a(";"):d("Expected 's' or 'i' as type for a key, but got ${str[offset-1]}",l-1)]=u();return o("}",e)}function u(){var e,t=i[l++].toLowerCase(),n=r.push(null)-1,e="s"===t?c(";"):"a"===t?(e=s({}),Object.keys(e).some(function(e,t){return e!==t.toString()})?e:Object.values(e)):d("Unexpected type "+t,l-1);return"r"!==t&&(r[n]=e),e}var e=u();return l!==i.length&&d("Unexpected trailing character"),e},s=[],u=[],c={},f={},p=null,h=null,m={};function d(e,t,n){e.normalize();var r,i="",l=Array.from(e.childNodes).find(function(e){return e.nodeType===Node.TEXT_NODE&&""!==(i="string"==typeof e.textContent?e.textContent:e.innerText).trim()});l?((r=document.createElement("span")).appendChild(document.createTextNode(i)),r[n]=t,e.replaceChild(r,l)):console.log("TextNode not found, label id "+e.id)}function o(e){for(var t,n=p.options[p.selectedIndex].value,r=0;r<s.length;r++){var i,l,d=s[r];y(i=document.getElementById("id_"+d+"_label_span"),l=document.getElementById("id_"+d),l.parentElement,m[d+"_"+n]),l.dispatchEvent(new CustomEvent("change"))}for(r=0;r<u.length;r++){var o=u[r];i=document.getElementById("fgroup_id_"+o+"_label_span"),l=document.getElementById("fgroup_id_"+o);var a,c=m[o+"_"+n];y(i,l,l,c)||((a=document.getElementById("fgroup_id_"+o+"_help_title")).setAttribute("title",m[o+"_help_title_"+n]),a.setAttribute("aria-label",m[o+"_help_title_"+n]),document.getElementById("fgroup_id_"+o+"_help_text").setAttribute("data-content",m[o+"_help_text_"+n]));o=document.getElementById("id_"+o+"coef");y(null,o,o.parentElement.parentElement,c)&&(o.value=0),o.dispatchEvent(new CustomEvent("update"))}t=n,(e=e)||(h.value=f[t].value,(e=document.querySelector('[data-filetypesdescriptions="id_filetypeslist"]')).firstChild.innerHTML=m.filetype_description,(e=e.firstChild.firstChild.firstChild).firstChild.replaceChild(document.createTextNode(f[t].description+" "),e.firstChild.firstChild),e.lastChild.replaceChild(document.createTextNode(h.value),e.lastChild.firstChild))}function y(e,t,n,r){return void 0===r?(t.hidden=!0,n.style.display="none"):(t.hidden=!1,n.style.display="",e&&e.replaceChild(document.createTextNode(r),e.firstChild)),t.hidden}function t(){var d=document.querySelector('[data-filetypesbrowserbody="id_filetypeslist"]');if(null===d||d.hasAttribute("data-used"))setTimeout(t,100);else{d.setAttribute("data-used","true");for(var o=p.options[p.selectedIndex].value,a=0;a<d.children.length;a++)!function(){var e=d.children[a],t="";if(e.getAttribute("data-filetypesbrowserkey")!==c[o])t="none";else{var n=e.querySelectorAll('input[data-filetypesbrowserkey][type="checkbox"]'),r=h.value.toString(),i={count:r=""===r?0:r.replace(","," ").split(" ").length,last:null};_(n,i);for(var l=0;l<n.length;l++)!function(){var e=n[l];e.addEventListener("change",function(){i.count+=e.checked?1:-1,_(n,i)})}()}e.style.display=t}()}}function _(e,t){1===t.count&&(t.last=Array.from(e).find(function(e){return e.checked})),t.last&&(t.last.disabled=1===t.count)}function a(){var e=document.querySelector('[data-filetypesbrowser="id_filetypeslist"]');0<e.childElementCount?e.firstChild.addEventListener("click",function(){t()}):setTimeout(a,100)}return{process:function(e){if(document.getElementById("id_responseformat")){s=e.params,u=e.groups,c=e.types.matches,f=e.types.defaults,p=document.getElementById("id_responseformat"),(h=document.getElementById("id_filetypeslist")).setAttribute("readonly","true");var t,n,r=document.getElementById("id_labels_container"),e=r.getAttribute("data-serialized");for(m=l(e),r.remove(),console.log(Object.keys(m).length+" labels were successfully parsed, container was removed"),t=0;t<s.length;t++)n="id_"+s[t],d(document.getElementById(n).parentElement,n+"_label_span","id");for(t=0;t<u.length;t++){n="fgroup_id_"+u[t],d(document.querySelector('[for="'+n+'"]'),n+"_label_span","id");var i=document.getElementById(n).children.item(0).children.item(0).children.item(0);i.id=n+"_help_text",i.children.item(0).id=n+"_help_title"}p.addEventListener("change",function(){o(!1)}),o(!0),a()}}}});